# -*- coding: utf-8 -*-
"""
Created on Mon Aug 16 09:35:43 2021

@author: Fanyi Sun
"""
import numpy as np
import matplotlib.pyplot as plt

x = np.linspace(0,2,100)
y = 1 / (1 + x)
# plt.scatter(x,y)

# if test == 'test1' and para == 'Longitudinal Toe Compliance [deg/N]' and vehicle = vehicle3
# RR
# x1 = [-1072.33022261639, -929.514643455038, -786.6990642936862, -643.883485132334, -501.0679059709819, -358.2523268096302, -215.436747648278, -72.62116848692585, 70.19441067442631, 213.00998983577847, 355.8255689971302, 498.6411481584824, 641.4567273198345, 784.2723064811862, 927.0878856425388, 1069.9034648038903]
# x2 = [-1192.701904296875, -1144.0308837890625, -1095.35986328125, -1046.6888427734375, -998.017822265625, -949.3468017578124, -900.67578125, -852.0047607421875, -803.333740234375, -754.6627197265625, -705.99169921875, -657.3206787109375, -608.649658203125, -559.9786376953125, -511.3076171875, -462.6365966796875, -413.965576171875, -365.2945556640625, -316.62353515625, -267.9525146484375, -219.281494140625, -170.6104736328125, -121.939453125, -73.2684326171875, -24.597412109375, 24.0736083984375, 72.74462890625, 121.4156494140625, 170.086669921875, 218.7576904296875, 267.4287109375, 316.0997314453125, 364.770751953125, 413.4417724609375, 462.11279296875, 510.7838134765625, 559.454833984375, 608.1258544921875, 656.796875, 705.4678955078125, 754.138916015625, 802.8099365234375, 851.48095703125, 900.1519775390625, 948.822998046875, 997.4940185546876, 1046.1650390625, 1094.8360595703125, 1143.507080078125, 1192.1781005859375]

# y1 = [0.1538143660141639, 0.1363219658804044, 0.1177748352198699, 0.0982903633076112, 0.0779830717395546, 0.0578743455176384, 0.0361926536287842, 0.0156422126009313, -0.004436651187749, -0.0239983565482957, -0.0450091633264186, -0.0642615420681996, -0.0836933995024543, -0.1018190666798608, -0.1187190378519351, -0.1353290215750232]
# y2 = [0.1326507540672619, 0.1284773025603008, 0.1238797246665984, 0.1190321568951441, 0.1137529433218545, 0.1083763149233164, 0.1031037287232988, 0.0976762389001462, 0.0923466013280948, 0.0865624159601151, 0.0818363528296452, 0.0759439593039106, 0.0706392405072137, 0.0651139732513656, 0.0595550056170999, 0.0541737449083689, 0.0490838526624514, 0.0434959108506383, 0.0383415211991261, 0.0328690318116425, 0.0275092177244805, 0.0221606900150994, 0.0169446714576818, 0.0115779065778018, 0.006465821881477, 0.0010231296821779, -0.0037665666828232, -0.0094383691543664, -0.0144719301739634, -0.0200896924186086, -0.0248182597298688, -0.0305948837595699, -0.035178055066384, -0.0411180399793455, -0.0459303063116289, -0.0517730340861262, -0.0568715355203466, -0.0621208485526585, -0.067382595981553, -0.0721653580245458, -0.077358378346934, -0.0817821949018412, -0.0856600301772152, -0.089689967812702, -0.0927412404235187, -0.0949613729681521, -0.0970255944218052, -0.0988577556018567, -0.100192176662935, -0.1011672328864677]

# RL
# x1 = [-1071.975790218431, -929.1771464445156, -786.3785026705996, -643.5798588966836, -500.7812151227681, -357.98257134885216, -215.1839275749362, -72.3852838010207, 70.41335997289525, 213.2120037468112, 356.0106475207272, 498.80929129464266, 641.6079350685586, 784.4065788424741, 927.2052226163904, 1070.003866390306]
# x2 = [-1191.8096923828125, -1143.1590227399554, -1094.5083530970985, -1045.857683454241, -997.207013811384, -948.5563441685268, -899.9056745256696, -851.2550048828125, -802.6043352399554, -753.9536655970982, -705.302995954241, -656.652326311384, -608.0016566685267, -559.3509870256696, -510.7003173828125, -462.0496477399553, -413.39897809709817, -364.74830845424106, -316.09763881138383, -267.4469691685267, -218.7962995256696, -170.1456298828124, -121.4949602399554, -72.84429059709805, -24.19362095424094, 24.45704868861617, 73.10771833147328, 121.7583879743304, 170.4090576171875, 219.05972726004484, 267.71039690290195, 316.36106654575906, 365.01173618861617, 413.6624058314733, 462.3130754743304, 510.9637451171875, 559.6144147600448, 608.265084402902, 656.9157540457591, 705.5664236886162, 754.2170933314733, 802.8677629743304, 851.5184326171877, 900.1691022600448, 948.8197719029016, 997.4704415457592, 1046.1211111886164, 1094.7717808314733, 1143.4224504743306, 1192.0731201171875]

# y1 = [0.168573436689962, 0.1486828959565729, 0.1279974471330434, 0.1066701510443152, 0.0855472827545459, 0.0640506338131977, 0.0419075994964228, 0.019266969804307, -0.0019825971928933, -0.0227610194214879, -0.0439670067432823, -0.0643165173144235, -0.0837258777221854, -0.1013429904478844, -0.1180459580986202, -0.1334729198876153]
# y2 = [0.1079465130083086, 0.1064100506432518, 0.1044881731726066, 0.1016035194596566, 0.098445037944977, 0.0946568619307788, 0.0899777969324056, 0.0859173243414052, 0.0806011403203582, 0.0762144513990609, 0.0710931099441228, 0.0658825131831757, 0.0608882624819996, 0.0558645221116079, 0.050884160531189, 0.0461726207978368, 0.0409214371989285, 0.0364731870529914, 0.0312089996409037, 0.0268981705764067, 0.0217199781480577, 0.0174346524559458, 0.0118098273645976, 0.0073881999385193, 0.0023780312827336, -0.0024670836432419, -0.007827779484696, -0.0126873817926906, -0.0177999439885706, -0.0226488324231564, -0.027766640789762, -0.0326517247227902, -0.0378890658388487, -0.0426863927729592, -0.0479692442645324, -0.0528511285250712, -0.0578522072484926, -0.0630860543757409, -0.0677667676596352, -0.0731811918486602, -0.0774898036578574, -0.082554198676762, -0.0868606766840539, -0.0913924110788058, -0.0958077192241089, -0.0999470775616639, -0.1032207324583553, -0.1056674860866303, -0.1078887579222283, -0.1093936658833964]

# FR
x1 = [-3355.542664819834, -3212.7530542490435, -3069.9634436782526, -2927.1738331074616, -2784.3842225366707, -2641.59461196588, -2498.805001395089, -2356.0153908242983, -2213.225780253508, -2070.436169682717, -1927.646559111926, -1784.8569485411354, -1642.0673379703444, -1499.2777273995537, -1356.488116828763, -1213.698506257972, -1070.908895687181, -928.1192851163904, -785.3296745455996, -642.5400639748086, -499.7504534040181, -356.9608428332272, -214.1712322624362, -71.3816216916457, 71.40798887914525, 214.1975994499362, 356.9872100207272, 499.77682059151766, 642.5664311623086, 785.3560417330991, 928.1456523038904, 1070.935262874681, 1213.7248734454715, 1356.514484016263, 1499.3040945870534, 1642.093705157844, 1784.8833157286354, 1927.6729262994256, 2070.4625368702164, 2213.252147441008, 2356.0417580117983, 2498.8313685825888, 2641.62097915338, 2784.4105897241707, 2927.200200294961, 3069.9898108657526, 3212.779421436543, 3355.5690320073336]
x2 = [-3431.60167709662, -3285.663070990114, -3139.724464883609, -2993.7858587771047, -2847.8472526706, -2701.9086465640944, -2555.970040457589, -2410.0314343510845, -2264.09282824458, -2118.154222138074, -1972.215616031569, -1826.277009925064, -1680.3384038185588, -1534.3997977120537, -1388.4611916055487, -1242.5225854990435, -1096.5839793925384, -950.6453732860332, -804.7067671795285, -658.7681610730233, -512.8295549665181, -366.89094886001294, -220.95234275350776, -75.01373664700259, 70.92486945950213, 216.8634755660073, 362.8020816725125, 508.74068777901766, 654.6792938855224, 800.6178999920276, 946.5565060985329, 1092.495112205038, 1238.433718311543, 1384.3723244180485, 1530.3109305245534, 1676.2495366310586, 1822.188142737564, 1968.126748844068, 2114.065354950573, 2260.0039610570784, 2405.942567163584, 2551.8811732700888, 2697.819779376594, 2843.758385483099, 2989.6969915896043, 3135.635597696109, 3281.574203802614, 3427.51280990912]

y1 = [-0.0287335943874538, -0.0251246977295042, -0.0213841661053202, -0.0174455969016435, -0.0130133444219311, -0.0087793522075169, -0.0044944765053712, -0.000681665646668, 0.0021662687498477, 0.0056532004807844, 0.0085547550715269, 0.0116098692363657, 0.0135904736911384, 0.0154942900041761, 0.0165664476970817, 0.0162433604399293, 0.0151161960380563, 0.0130583179974259, 0.0101882054543553, 0.007248866876107, 0.0030305837353815, -0.0005826869113492, -0.0057868374417143, -0.0100761220086887, -0.0148438005488502, -0.0191938256444491, -0.0234274807119471, -0.0275579767125296, -0.0313209707949268, -0.0335491232718664, -0.0355313100346925, -0.0365031111339867, -0.0367660719380937, -0.037019920055703, -0.0370877675903069, -0.0370437946079434, -0.036771464597034, -0.0365551528705756, -0.0363456994589348, -0.0357103332346529, -0.0358454413315817, -0.0344287545193584, -0.0330288904804708, -0.031920180762074, -0.0301704517470456, -0.0290672158753626, -0.0280084008164079, -0.0274504441184937]
y2 = [-0.0387443899158539, -0.0351575053194523, -0.0316650928850952, -0.0286646977513273, -0.0256297360927793, -0.0228106659369343, -0.02026848925676, -0.0175566678553896, -0.0150961585973455, -0.0129489270098648, -0.0109306145526287, -0.0092535430798871, -0.007785669747601, -0.006589959581748, -0.0058437623541953, -0.0054334167535037, -0.0058852275398911, -0.0059636186147627, -0.006626668644905, -0.0071150716080438, -0.0077299223117186, -0.0078053878109845, -0.0080475528824555, -0.0086035719266222, -0.0089562639253774, -0.0107547159300191, -0.0127671826639509, -0.0144590523766012, -0.0147927121852807, -0.0137416900804724, -0.0136388425042585, -0.0130904808279225, -0.0121078324748438, -0.0111029486574861, -0.0095229800337213, -0.0079980552037068, -0.0058472273525996, -0.0038893265179902, -0.0017102238489331, 0.0007861652870014, 0.0029136746599175, 0.0056729149061809, 0.0078452549311443, 0.0108302816453145, 0.0135207211301704, 0.0164582680577164, 0.0197639998615515, 0.0227038503477284]

# FL
# x1 = [-3348.402303890306, -3205.728435905612, -3063.054567920918, -2920.3806999362246, -2777.7068319515306, -2635.0329639668366, -2492.3590959821427, -2349.685227997449, -2207.011360012755, -2064.337492028061, -1921.6636240433672, -1778.9897560586733, -1636.3158880739795, -1493.6420200892856, -1350.9681521045918, -1208.2942841198978, -1065.620416135204, -922.94654815051, -780.2726801658164, -637.5988121811224, -494.9249441964285, -352.25107621173447, -209.5772082270405, -66.90334024234653, 75.77052774234699, 218.44439572704096, 361.1182637117349, 503.7921316964289, 646.4659996811224, 789.1398676658164, 931.8137356505104, 1074.4876036352043, 1217.1614716198983, 1359.8353396045925, 1502.5092075892862, 1645.1830755739802, 1787.8569435586742, 1930.5308115433672, 2073.204679528061, 2215.878547512755, 2358.552415497449, 2501.226283482143, 2643.900151466837, 2786.574019451531, 2929.247887436225, 3071.921755420919, 3214.595623405613, 3357.269491390307]
# x2 = [-3429.182472696109, -3283.2892617984694, -3137.3960509008293, -2991.502840003189, -2845.6096291055483, -2699.716418207908, -2553.823207310268, -2407.929996412628, -2262.036785514987, -2116.143574617347, -1970.250363719707, -1824.3571528220664, -1678.463941924426, -1532.5707310267858, -1386.6775201291457, -1240.7843092315052, -1094.8910983338646, -948.9978874362246, -803.1046765385845, -657.211465640944, -511.3182547433034, -365.42504384566337, -219.5318329480233, -73.63862205038276, 72.25458884725776, 218.14779974489784, 364.0410106425379, 509.9342215401784, 655.827432437819, 801.7206433354586, 947.6138542330992, 1093.5070651307396, 1239.4002760283802, 1385.2934869260207, 1531.1866978236603, 1677.0799087213009, 1822.9731196189412, 1968.866330516581, 2114.759541414221, 2260.652752311862, 2406.5459632095026, 2552.439174107143, 2698.3323850047827, 2844.2255959024237, 2990.118806800064, 3136.0120176977034, 3281.905228595344, 3427.7984394929845]

# y1 = [-0.0861747558853998, -0.0826023818017179, -0.0783347896584034, -0.0727524974136853, -0.0676900420264911, -0.0626361368875695, -0.0571184182366431, -0.051977497178699, -0.0474747520465014, -0.0426456168846282, -0.038092305609795, -0.0333676299369951, -0.0287617655947334, -0.0244033364579522, -0.0201729173032328, -0.0166241808631606, -0.0135123243136306, -0.0112425799210667, -0.009660019052735, -0.0084943156975958, -0.007210103087615, -0.0065137746646472, -0.0060938538237198, -0.0063424812504284, -0.0081987098031872, -0.00829585227437, -0.0085512788119048, -0.0084016259570435, -0.0086740967048139, -0.0080574510107467, -0.0069825399962313, -0.0058642150579958, -0.0041637185254064, -0.0024899894408863, -0.0004559983507953, 0.001875535590159, 0.0038514150146162, 0.0059641231189105, 0.0080924401735016, 0.0099452883451974, 0.0118744382084544, 0.0147975435859158, 0.0181695628316351, 0.0215021131667901, 0.0246303653210954, 0.0277068489222802, 0.0313514595025138, 0.0363323651911723]
# y2 = [-0.0210779929873153, -0.0173514493818305, -0.0139824731741926, -0.0107910625640046, -0.0079434492996536, -0.0055003103544672, -0.003203126439629, -0.0012043321370081, 0.0003957567658297, 0.0023063201660162, 0.0039080630197201, 0.0051622364495477, 0.0061843867666376, 0.0068973358188737, 0.0073102815647805, 0.006706255607115, 0.0063174742786418, 0.004591536063816, 0.0032817348121877, 0.0004771706504174, -0.0016460460225346, -0.0030848269889318, -0.0048182000192263, -0.0073046364276329, -0.0099158525654775, -0.0131960160665512, -0.0160018341819622, -0.019936811515177, -0.022385559391457, -0.0257319580209369, -0.0274942669555339, -0.0291687152482412, -0.0296605876256473, -0.0302261275174347, -0.0299008850274684, -0.0292416707729377, -0.0287251580662487, -0.0279229877829349, -0.0269895701410048, -0.026057426647752, -0.0250893166881741, -0.023818438360939, -0.0225485861215908, -0.0215178004156192, -0.0200122694194279, -0.0177123539702466, -0.0154818382849701, -0.0120511228299342]


plt.scatter(x1,y1,c='r',s=2,label='sample')
plt.scatter(x2,y2,c='b',s=2,label='target')
plt.legend()
plt.axis([-5000,5000,-1,1])

def find_value(x, xn, yn):
    min_diff = 1e5
    # print('len',len(xn))
    # search the closest point
    for i in range(1,len(xn)-1): # ignore the first and last index
        if abs(x - xn[i]) < min_diff:
            min_diff = abs(x - xn[i])
            pos = i
    if x >= xn[pos]:
        pre = [xn[pos],yn[pos]]
        nex = [xn[pos+1],yn[pos+1]]
    else:
        pre = [xn[pos-1],yn[pos-1]]
        nex = [xn[pos],yn[pos]]
    # using linear interpolation
    y = pre[1] + (nex[1] - pre[1])/(nex[0] - pre[0]) * (x - pre[0])
    return y

diff = []
for i in range(len(x1)):
    # find the y value from target curve at a specific x
    # add constrains when searching value to improve speed
    ratio = len(x2) / len(x1)
    toleft = round(i * ratio) - 5
    toright = round(i * ratio) + 5
    # print('ratio',ratio)
    # print('i',i)
    # print('left',toleft)
    # print('right',toright)
    if round(i * ratio) < 5:
        y = find_value(x1[i],x2[:toright],y2[:toright])
    elif round(i * ratio) >= len(x1) - 5:
        y = find_value(x1[i],x2[toleft:],y2[toleft:])
    else:
        y = find_value(x1[i], x2[toleft:toright],
                                     y2[toleft:toright])
    diff.append(np.abs((y1[i] - y) / y))

avg_diff = np.nanmean(diff)
print(avg_diff)
print(1 / (1 + avg_diff))
